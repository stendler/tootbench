---
- name: Stopping Benchmark
  hosts: clients
  become: yes
  tasks:
    - name: Stopping tootbench client
      systemd:
        name: tootbench.service
        state: stopped
    - name: Wait to collect benchmark aftermath metrics
      pause:
        minutes: "3"

- name: Stopping monitoring
  hosts: all
  become: yes
  tasks:
    - name: Stopping vmstat monitoring service
      systemd:
        name: vmstat.service
        state: stopped
    - name: Stopping iostat cpu monitoring service
      systemd:
        name: iostat-cpu.service
        state: stopped
    - name: Stopping iostat disk monitoring service
      systemd:
        name: iostat-disk.service
        state: stopped
    - name: Stopping mpstat monitoring service
      systemd:
        name: mpstat.service
        state: stopped
    - name: Stopping docker stats monitoring service
      systemd:
        name: docker-stats.service
        state: stopped
    - name: Stopping docker stats monitoring service timer
      systemd:
        name: docker-stats.timer
        state: stopped

- name: Stopping Mastodon
  hosts: instances
  tasks:
    - name: Stop mastodon containers
      command:
        chdir: /home/ansible
        cmd: docker compose --project-name mastodon stop
      environment:
        hostname: "{{ inventory_hostname }}"

